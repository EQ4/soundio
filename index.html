<script src="modules/collection/js/object.assign.js"></script>
<script src="modules/collection/js/observe.js"></script>
<script src="modules/collection/js/mixin.array.js"></script>
<script src="modules/collection/js/mixin.events.js"></script>
<script src="modules/collection/js/collection.js"></script>
<script src="modules/audio-object/js/audio-object.js"></script>
<script src="modules/midi/js/midi.js"></script>
<script src="modules/midi/js/midi-utils.js"></script>
<script src="modules/clock/js/clock.js"></script>
<script src="modules/sequence/src/sequence.js"></script>

<script src="js/window.audiocontext.js"></script>
<script src="js/navigator.getusermedia.js"></script>
<script src="js/soundio.js"></script>
<script src="js/soundio.midi.js"></script>
<script src="js/soundio.objects.js"></script>
<script src="js/soundio.input.js"></script>
<script src="js/soundio.output.js"></script>
<script src="js/soundio.track.js"></script>
<script src="js/soundio.send.js"></script>
<script src="js/soundio.filter.js"></script>
<script src="js/soundio.flange.js"></script>
<script src="js/soundio.gain.js"></script>
<script src="js/soundio.loop.js"></script>
<script src="js/soundio.sample.js"></script>
<script src="js/soundio.saturate.js"></script>
<script src="js/soundio.compress.js"></script>
<script src="js/soundio.envelope.js"></script>
<script src="js/soundio.metronome.js"></script>
<script src="js/soundio.oscillator.js"></script>

<script>
(function(window) {
	"use strict";

	var soundio = window.soundio = window.Soundio({
		objects: [
			{id: 1, type: "tone-synth"},
			{id: 2, type: "output"},
			{id: 3, type: "metronome", playing: true }
		],

		connections: [
			{source: 1, destination: 2},
			{source: 3, destination: 2}
		]
	});

	var osc = window.osc = soundio.find(1);
	var metronome = window.metronome = soundio.find(3);

	soundio.clock.tempo(0, 120);

	var data = [
		[0,   "noteon",  36, 1],
		[4,   "noteoff", 36, 1],
		[2,   "noteon",  64, 0.8],
		[2.5, "noteoff", 64, 0.8],
		[2,   "noteon",  58, 0.8],
		[2.5, "noteoff", 58, 0.8],
		[2,   "noteon",  43, 0.8],
		[2.5, "noteoff", 43, 0.8],
		[2.5, "noteon",  65, 0.6],
		[3,   "noteoff", 65, 0.6],
		[3,   "noteon",  67, 1],
		[3.5, "noteoff", 67, 1],
		[3.5, "noteon",  62, 1],
		[7,   "noteoff", 62, 1],
		[3.5, "noteon",  46, 1],
		[7,   "noteoff", 46, 1],
		[3.5, "noteon",  53, 1],
		[7,   "noteoff", 53, 1]
	];

	var sequence = Sequence(soundio.clock, [
		[0, "sequence", data, 1],
		//[4, "sequence", data, 2],
		[7, "sequence", data, 2],
		[10, "sequence", data, 3],
		[12, "sequence", data, 4],
		//[2, "sequence", data, 0.5]
	]);

	var synth = soundio.find(1);

	sequence.plug(function() {
		synth.trigger.apply(synth, arguments);
	});

	setTimeout(function() {
		sequence.start(4);
		sequence.cue(8, function(time) {
			metronome.stop();
		});
	}, 600);

})(window);
</script>